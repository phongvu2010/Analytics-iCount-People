store:
  source_table: dbo.store
  dest_table: dim_stores
  description: "Bảng dimension (bảng chiều) chứa thông tin định danh các cửa hàng."
  processing_order: 10  # Chạy trước tiên
  incremental: false
  rename_map:
    tid: store_id
    name: store_name
  cleaning_rules:
    - column: store_name
      action: strip

num_crowd:
  source_table: dbo.num_crowd
  dest_table: fact_traffic
  description: "Bảng fact (bảng sự kiện) ghi nhận dữ liệu lượt ra/vào của khách."
  processing_order: 20  # Chạy sau store
  incremental: true
  timestamp_col: recordtime
  partition_cols: [year, month]
  rename_map:
    recordtime: recorded_at
    in_num: visitors_in
    out_num: visitors_out
    position: device_position
    storeid: store_id
  cleaning_rules:
    - column: device_position
      action: strip

ErrLog:
  source_table: dbo.ErrLog
  dest_table: fact_errors
  description: "Bảng fact ghi nhận các lỗi phát sinh từ thiết bị đếm."
  processing_order: 20  # Chạy sau store
  incremental: true
  timestamp_col: LogTime
  partition_cols: [year, month]
  rename_map:
    ID: log_id
    storeid: store_id
    DeviceCode: device_code
    LogTime: logged_at
    Errorcode: error_code
    ErrorMessage: error_message
  cleaning_rules:
    - column: error_message
      action: strip
